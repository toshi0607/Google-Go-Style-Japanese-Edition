- [Goスタイル決定事項](#goスタイル決定事項)
  - [概要](#概要)
  - [命名](#命名)
    - [アンダースコア](#アンダースコア)
    - [パッケージ名](#パッケージ名)
    - [レシーバ名](#レシーバ名)
    - [定数名](#定数名)
    - [頭字語](#頭字語)
    - [ゲッター](#ゲッター)
    - [変数名](#変数名)
      - [一文字の変数名](#一文字の変数名)
    - [繰り返し](#繰り返し)
      - [パッケージ名とエクスポートされたシンボル名](#パッケージ名とエクスポートされたシンボル名)
      - [変数名と型](#変数名と型)
      - [外部コンテキストとローカル名](#外部コンテキストとローカル名)
  - [コメント](#コメント)
    - [コメント行の長さ](#コメント行の長さ)

# Goスタイル決定事項

https://google.github.io/styleguide/go/decisions

注意: このドキュメントは、Googleでの[Goスタイル](https://google.github.io/styleguide/go/index)の概要を説明する一連のドキュメントの一部です。このドキュメントは規範的なものですが、標準的なものではなく、コアスタイル ガイドに従属するものです。詳しくは、概要をご覧ください。

## 概要

このドキュメントには、Goの可読性メンターが行うアドバイスに対する標準的なガイダンス、説明、例を統一して提供することを目的としたスタイル決定事項が含まれています。

このドキュメントは完全なものではなく、時間の経過とともに拡張されていきます。コアスタイルガイドがここで提供するアドバイスと矛盾する場合はスタイルガイドが優先され、それに応じてこのドキュメントが更新される必要があります。

Go スタイル ドキュメントの完全なセットについては、[概要](./README.md#概要)を参照してください。

以下のセクションは、スタイルの決定事項からガイドの別の部分に移動しました。

- ミックスキャップ: [ガイド#ミックスキャップ](./guide.md#ミックスキャップ)を参照
- フォーマット: [ガイド#フォーマット](./guide.md#フォーマット)を参照
- 行の長さ: [ガイド#行の長さ](./guide.md#行の長さ)を参照

## 命名

命名の全般的なガイダンスについては、[コアスタイルガイド](./guide.md#命名)の命名のセクションを参照してください。次のセクションでは、命名の特定の領域についてさらに詳しく説明しています。

### アンダースコア

Goの名前は一般的にアンダースコアを含めてはいけません。この原則には3つの例外があります。

1. 生成されたコードによってのみインポートされるパッケージ名には、アンダースコアを含めることができます。複数単語のパッケージ名の選び方について、詳しくは[パッケージ名](#パッケージ名)をご覧ください。
2. `test.go`ファイル内の`Test`、`Benchmark`、`Example`関数名にはアンダースコアを含めることができます。
3. オペレーティングシステムや`cgo`と相互運用する低レベルのライブラリは、`syscall`で行われているように識別子を再利用することができます。これは、ほとんどのコードベースでは非常にまれなことだと思われます。

### パッケージ名

Goのパッケージ名は短く、小文字のみを使用する必要があります。複数の単語からなるパッケージ名は、すべて小文字で切れ目がないようにしなければなりません。たとえば、[tabwriter](https://pkg.go.dev/text/tabwriter)というパッケージは`tabWriter`、`TabWriter`、`tab_writer`という名前ではいけません。

よく使われるローカル変数名と[重複](#TBD)しそうなパッケージ名は選ばないようにしてください。たとえば、`count`は一般的に使用される変数名なので、`count`よりも`usercount`の方がよいパッケージ名です。

Goのパッケージ名にはアンダースコアは使わないでください。アンダースコアを含むパッケージをインポートする必要がある場合（通常は生成されたコードやサードパーティのコードから）、インポート時にGoコードで使用するのに適した名前に変更する必要があります。

例外として、生成されたコードによってのみインポートされるパッケージ名にはアンダースコアを含めることができます。具体的な例としては、以下のようなものがあります。

- 統合テストなど、外部のテストパッケージに`_test`サフィックスを使用する
- [パッケージレベルのドキュメントのサンプル](https://go.dev/blog/examples)に`_test`サフィックスを使用する

`util`、`utility`、`common`、`helper`などの情報量の少ないパッケージ名は避けてください。[いわゆる「ユーティリティパッケージ」](#TBD)については、こちらをご覧ください。

インポートされたパッケージの名前が変更された場合 (例: `import foopb "path/to/foo_go_proto"`) 、パッケージのローカル名は上記のルールに従わなければなりません。特定のインポートが複数のファイル、特に同じパッケージや近くのパッケージで改名された場合、一貫性を保つために可能な限り同じローカル名を使用する必要があります。

こちらも参照してください: [パッケージ名に関するGoブログ記事](https://go.dev/blog/package-names)

### レシーバ名

[レシーバ](https://golang.org/ref/spec#Method_declarations)変数名は、以下の通りでなければなりません。

- 短い（通常1文字か2文字の長さ）
- 型自体の略称
- その型に対するすべてのレシーバで一貫

| 長い名前 | より良い名前 |
| :---: | :---: |
| `func (tray Tray)` | `func (t Tray)` |
| `func (info *ResearchInfo)` | `func (ri *ResearchInfo)` |
| `func (this *ReportWriter)` | `func (w *ReportWriter)` |
| `func (self *Scanner)` | `func (s *Scanner)` |

### 定数名

定数名は、Goの他の名前と同様に[ミックスキャップ](./guide.md#ミックスキャップ)を使用しなければなりません。（エクスポートされた定数は大文字で始まり、エクスポートされていない定数は小文字で始まります。）これは、他の言語での慣習を破っている場合でも適用されます。定数名はその値の派生物であってはならず、代わりにその値が示すものを説明しなければなりません。

```go
// Good:
const MaxPacketSize = 512

const (
    ExecuteBit = 1 << iota
    WriteBit
    ReadBit
)
```

ミックスキャップでない定数名や、`k`のプレフィックスを持つ定数は使用しないでください。

```go
// Bad:
const MAX_PACKET_SIZE = 512
const kMaxBufferSize = 1024
const KMaxUsersPergroup = 500
```

定数には、値ではなく役割に基づいて名前を付けます。もし定数がその値とは別に役割を持たないのであれば、定数として定義する必要はありません。

```go
// Bad:
const Twelve = 12

const (
    UserNameColumn = "username"
    GroupColumn    = "group"
)
```

### 頭字語

頭文字や頭字語である名前の単語（例えば、`URL`と`NATO`）は、同じ大文字を使用する必要があります。`URL`は`URL`または`url`（`urlPony`や`URLPony`のように）と表記し、決して`Url`と表記してはいけません。これは、`ID`が「識別子」の略称である場合にも適用され、`appId`の代わりに`appID`と書きます。

- 複数の頭文字を含む名前（例：`XML`と`API`を含む`XMLAPI`）では、ある頭文字内の各文字は同じケースを持つべきですが、名前内の各頭文字は同じケースである必要はありません。
- 小文字の頭文字を含む名前（例：`DDoS`、`iOS`、`gRPC`）では、エクスポートのために最初の文字を変更する必要がない限り、頭文字は通常の散文と同じように表記すべきです。この場合、頭文字全体を同じ大文字にする必要があります（例：`ddos`、`IOS`、`GRPC`)。

| 頭文字 | スコープ | 正 | 誤 |
| :---: | :---: | :---: | :---: |
| XML API | 公開 | `XMLAPI` | `XmlApi`、`XMLApi`、`XmlAPI`、`XMLapi` |
| XML API | 非公開 | `xmlAPI` | `xmlapi`、`xmlApi`|
| iOS | 公開 | `IOS` | `Ios`、`IoS`|
| iOS | 非公開 | `iOS` | `ios`|
| gRPC | 公開 | `GRPC` | `Grpc`|
| gRPC | 非公開 | `gRPC` | `grpc`|
| DDoS | 公開 | `DDoS` | `DDOS`、`Ddos` |
| DDoS | 非公開 | `ddos` | `dDoS`、`dDOS` |

### ゲッター

関数名やメソッド名には、基本概念で「`get`」（例: `HTTP GET`）という単語が使用 されていない限り、 `Get`や`get`というプレフィックスを使用すべきではありません。例えば、 `GetCounts`よりも`Counts`を使用するように、名前を直接名詞で開始することを推奨します。

関数が複雑な計算の実行やリモートコールを伴う場合は、`Get`の代わりに`Compute`や`Fetch`などの別の単語を使用して、関数呼び出しに時間がかかり、ブロックや失敗する可能性があることを読者に明確に伝えることができます。

### 変数名

一般的な経験則では、名前の長さはそのスコープの大きさに比例し、そのスコープ内で使用される回数に反比例するはずです。ファイルスコープで作成された変数は複数の単語を必要とするかもしれませんが、単一の内部ブロックにスコープされた変数は、コードを明確に保ち、余計な情報を避けるために、1単語または1〜2文字で済むかもしれません。

以下は大まかな目安です。これらの数値のガイドラインは、厳密な規則ではありません。文脈、明確さ、簡潔さに基づいて判断してください。

- 小さなスコープとは、1～2個の小さな操作が行われるもので、1～7行です。
- 中程度のスコープとは、8～15行程度の小さな操作を数回、または大きな操作を1回行うものです。
- 大きなスコープとは、1つまたはいくつかの大きな操作が行われるもので、たとえば15～25行のものです。
- 非常に大きなスコープとは、1ページ以上にわたるもの（たとえば25行以上）です。

小さなスコープでは、完全に明確な名前（たとえば、カウンタ用の`c`）でも、大きなスコープでは不十分な場合があり、コード内で読者にその目的を思い出させるために明確化する必要があります。変数の数が多い場合や、似たような値や概念を表す変数がある場合は、スコープが示すよりも長い変数名が必要になることがあります。

また、概念の具体性によって、変数名を簡潔にすることができます。たとえば、使用するデータベースが1つだけだと仮定すると、`db`のような短い変数名は通常非常に小さなスコープに予約されるかもしれませんが、スコープが非常に大きくても、完全に明確なままであるかもしれません。この場合、`database`という単語はスコープの大きさによっては許容されるかもしれませんが、`db`は非常に一般的な単語の短縮形であり、別の解釈はほとんどないため必須ではありません。

ローカル変数の名前は、その値がどこで作られたかよりも、その変数が何を含んでいて現在の文脈でどのように使われているかを反映したものでなければなりません。たとえば、最適なローカル変数の名前が構造体やプロトコルバッファのフィールド名と同じでないことはよくあります。

一般的には

- `count`や`options`のような一語の名前は良い出発点です。
- `userCount`と`projectCount`のように、似たような名前の曖昧さをなくすために単語を追加することができます。
- 入力の手間を省くために単純に文字を削除しないでください。たとえば、`Sandbox`は`Sbx`よりも優先され、特にエクスポートされた名前ではそうです。
- ほとんどの変数名では型や型に似た単語を省きます。
  - 数値の場合、`userCount`は`numUsers`や`usersInt`よりもよい名前です。
  -スライスの場合、`users`は`userSlice`よりも良い名前です。
  - たとえば、入力が`ageString`で保存され、解析された値が`age`であるような場合、型に似た修飾子を入れてもかまいません。
- 周囲の文脈から明らかな単語は省略します。たとえば、`UserCount`メソッドの実装では、`userCount`というローカル変数はおそらく冗長です。

#### 一文字の変数名

一文字の変数名は繰り返しを最小限にするのに便利なツールですが、コードを不必要に不透明にすることもあります。完全な単語が明らかで、一文字の変数の代わりにその単語を使用することが繰り返しになる場合のみに使用を制限してください。

一般的には

- [メソッドレシーバ変数](#レシーバ名)には、1文字か2文字の名前を付けるのが望ましいです。
- 一般的な型のために親しい変数名を使用することは、しばしば役に立ちます。
  - `r`は`io.Reader`や`*http.Request`です。
  - `w`は`io.Writer`や`http.ResponseWriter`です。
- 整数型のループ変数では、特にインデックス（`i`など）や座標（`x`や`y`など）には一文字の識別子を使うことができます。
- スコープが短い場合は、`_, n := range nodes { ... }`のように省略形もループ識別子として使用できます。

### 繰り返し

Goのソースコードの一部では、不必要な繰り返しを避ける必要があります。よくあるのが名前の繰り返しで、不要な単語が含まれていたり、文脈や型が繰り返されることがよくあります。コード自体も、同じまたは似たようなコードセグメントが近接して何度も現れると、不必要に繰り返されることがあります。

反復的な命名には、次のようなさまざまな形態があります。

#### パッケージ名とエクスポートされたシンボル名

エクスポートされたシンボルに名前を付ける場合、パッケージの名前は常にパッケージの外から見えるので、両者の間の冗長な情報は減らすか排除する必要があります。パッケージが1つの型だけをエクスポートし、それがパッケージ自身の名前になる場合、コンストラクタの正規名が必要であれば`New`になります。

| 反復的な名前 | 良い名前 |
| :---: | :---: |
| `widget.NewWidget` | `widget.New` |
| `widget.NewWidgetWithName` | `widget.NewWithName` |
| `db.LoadFromDatabase` | `db.Load` |
| `goatteleportutil.CountGoatsTeleported` | `gtutil.CountGoatsTeleported`か `goatteleport.Count` |
| `myteampb.MyTeamMethodRequest` | `mtpb.MyTeamMethodRequest`か `myteampb.MethodRequest` |

#### 変数名と型

コンパイラは常に変数の型を把握しており、またほとんどの場合、変数の使われ方によって読者にもその型がわかるようになっています。変数の型を明確にする必要があるのは、その値が同じスコープに2回現れる場合だけです。

| 反復的な名前 | 良い名前 |
| :---: | :---: |
| `var numUsers int` | `var users int` |
| `var nameString string` | `var name string` |
| `var primaryProject *Project` | `var primary *Project` |

値が複数の形式で現れる場合は、`raw`や`parsed`といった補足的な単語や、基本的な表現で明らかにすることができます。

```go
// Good:
limitStr := r.FormValue("limit")
limit, err := strconv.Atoi(limitStr)
```

```go
// Good:
limitRaw := r.FormValue("limit")
limit, err := strconv.Atoi(limitRaw)
```

#### 外部コンテキストとローカル名

名前に周囲のコンテキストの情報を含めると、多くの場合、利点のない余計なノイズが発生します。パッケージ名、メソッド名、型名、関数名、インポートパス、そしてファイル名さえも、その中のすべての名前を自動的に修飾するコンテキストを提供することができます。

```go
// Bad:
// In package "ads/targeting/revenue/reporting"
type AdsTargetingRevenueReport struct{}

func (p *Project) ProjectName() string
```

```go
// Good:
// In package "ads/targeting/revenue/reporting"
type Report struct{}

func (p *Project) Name() string
```

```go
// Bad:
// In package "sqldb"
type DBConnection struct{}
```

```go
// Good:
// In package "sqldb"
type Connection struct{}
```

```go
// Bad:
// In package "ads/targeting"
func Process(in *pb.FooProto) *Report {
    adsTargetingID := in.GetAdsTargetingID()
}
```

```go
// Good:
// In package "ads/targeting"
func Process(in *pb.FooProto) *Report {
    id := in.GetAdsTargetingID()
}
```

繰り返しは一般的に、単独で評価するのではなく、シンボルの使用者のコンテキストで評価されるべきです。たとえば、次のコードにはたくさんの名前があり、ある状況下では問題なくても、コンテキスト上では冗長になっています。

```go
// Bad:
func (db *DB) UserCount() (userCount int, err error) {
    var userCountInt64 int64
    if dbLoadError := db.LoadFromDatabase("count(distinct users)", &userCountInt64); dbLoadError != nil {
        return 0, fmt.Errorf("failed to load user count: %s", dbLoadError)
    }
    userCount = int(userCountInt64)
    return userCount, nil
}
```

その代わり、コンテキストや 使い方から明らかな名称については、情報を省略することができる場合が多いです。

```go
// Good:
func (db *DB) UserCount() (int, error) {
    var count int64
    if err := db.Load("count(distinct users)", &count); err != nil {
        return 0, fmt.Errorf("failed to load user count: %s", err)
    }
    return int(count), nil
}
```

## コメント

コメントに関する規約（何をコメントするか、どのようなスタイルを使うか、実行可能な例をどのように提供するか、など）は、公開APIのドキュメントを読む経験を支援することを目的としています。詳しくは[Effective Go](http://golang.org/doc/effective_go.html#commentary)をご覧ください。

ベストプラクティスドキュメントの[ドキュメント規約](#TBD)のセクションで、このことについてさらに議論しています。

*ベストプラクティス*: 開発中やコードレビュー中に[doc preview](#TBD)を使って、ドキュメントや実行可能な例が有用かどうか、期待通りの形で表示されているかどうかを確認します。

*ヒント*：Godocはほとんど特別な書式を使いません。リストとコードスニペットは通常、行の折り返しを避けるためにインデントされるべきです。インデントとは別に、装飾は一般的に避けるべきです。

### コメント行の長さ

狭い画面でもソースからコメントが読めるようにしてください。

コメントが長くなりすぎた場合は、複数の一行コメントにまとめることをお勧めします。可能な限り、80カラム幅の端末で読めるコメントを目指します。ただし、これは厳密な制限ではなく、Goのコメントには決まった行の長さの制限はありません。たとえば標準ライブラリは、句読点に基づいてコメントを分割することがよくあり、その場合個々の行が60～70文字の近くになることがあります。

既存のコードには、コメントが80字を超えるものがたくさんあります。このガイドラインは、可読性レビューの一環としてそのようなコードを変更する正当な理由として使用されるべきではありませんが（[一貫性](guide.md#一貫性)を参照）、チームは他のリファクタリングの一環として、このガイドラインに従うように臨機応変にコメントを更新することが推奨されます。このガイドラインの主な目標は、すべてのGoの可読性メンターが、提言がなされる場合に同じ提言をすることを確実にすることです。

解説の詳細については、[ドキュメントに関するGoブログの記事](https://blog.golang.org/godoc-documenting-go-code)をご覧ください。

```go
# Good:
// これはコメントの段落です。
// Godocでは個々の行の長さは関係ありません。
// しかし、折り返しを選択することで、狭い画面でも読みやすくなっています。
//
// 長いURLはあまり気にしないでください。
// https://supercalifragilisticexpialidocious.example.com:8080/Animalia/Chordata/Mammalia/Rodentia/Geomyoidea/Geomyidae/
//
// 同様に、その他の情報でも不自然になっているものがあれば
// 妨げになるのではなく、むしろ役に立つのであれば
// 適宜長い改行を入れてください。
```

小さな画面で何度も折り返されるようなコメントは、読者の体験を悪くするので避けてください。

```go
# Bad:
// これはコメントの段落です。Godocでは個々の行の長さは関係ありません。
// しかし、折り返しを選択することで、
// 狭い画面でも読みやすくなっています。
//
// 長いURLはあまり気にしないでください。
// https://supercalifragilisticexpialidocious.example.com:8080/Animalia/Chordata/Mammalia/Rodentia/Geomyoidea/Geomyidae/
```
