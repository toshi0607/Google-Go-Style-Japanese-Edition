- [Goスタイルガイド](#goスタイルガイド)
  - [スタイルの原則](#スタイルの原則)
    - [明確さ](#明確さ)
      - [コードが実際に行っていることは何か？](#コードが実際に行っていることは何か)
      - [なぜそのようなコードになっているのか？](#なぜそのようなコードになっているのか)

# Goスタイルガイド

https://google.github.io/styleguide/go/guide

注意: このドキュメントは、Googleでの[Goスタイル](https://google.github.io/styleguide/go/index)の概要を説明する一連のドキュメントの一部です。このドキュメントは規範的かつ標準的なものです。詳しくは、[概要](https://github.com/toshi0607/Google-Go-Style-Japanese-Edition#%E6%A6%82%E8%A6%81)をご覧ください。

## スタイルの原則

読みやすいGoコードの書き方には、いくつかの包括的な原則があります。以下は、読みやすいコードの属性で、重要なものから順に並べています。

- [明確さ](#明確さ): コードの目的と根拠が読み手にとって明確であること
- シンプルさ: コードができるだけシンプルな方法で目的を達成していること
- 簡潔さ: 信号対雑音比が高いこと
- 保守性: 保守しやすいコードであること
- 一貫性: Googleのコードベースと整合性がとれている

### 明確さ

可読性の中核となる目標は、読み手にとって明確なコードを作成することです。

このことは、効果的な命名、役に立つコメント、効率的なコード構成によって達成されます。

このとき、コードの記述者ではなく、読み手の視点に立つことが大切です。コードが読みやすいことは、書きやすいことよりも重要です。コードの明確さには、2つの異なる側面があります。

- [Goスタイルガイド](#goスタイルガイド)
  - [スタイルの原則](#スタイルの原則)
    - [明確さ](#明確さ)
      - [コードが実際に行っていることは何か？](#コードが実際に行っていることは何か)
      - [なぜそのようなコードになっているのか？](#なぜそのようなコードになっているのか)

#### コードが実際に行っていることは何か？

Goは、コードが何をしているのかが比較的わかりやすいように設計されています。しかし、コードを理解するために読者が予備知識を必要とするような不確実な場合は、将来の読者のためにコードの目的を明確にするために時間を費やす価値があります。たとえば、以下のようなことが考えられます。

- より説明的な変数名を使用する
-コメントを追加する
- 空白文字やコメントでコードを分割する
- コードを別の関数やメソッドにリファクタリングして、よりモジュール化する

万能のアプローチはありませんが、Goのコードを開発するときは、わかりやすさを優先することが重要です。

#### なぜそのようなコードになっているのか？

コードの根拠は、変数名、関数名、メソッド名、パッケージ名で十分に伝わることが多いです。そうでない場合は、コメントを追加することが重要です。特に、コードに読者が馴染みのないニュアンスが含まれている場合などは、「なぜ？」が重要です。

- 言語のニュアンス: たとえば、クロージャがループ変数を捕捉しているが、クロージャは何行も先にある
- ビジネスロジックのニュアンス:  たとえば、実際のユーザーとなりすましたユーザーを区別する必要のあるアクセス制御チェック

APIを正しく使用するために注意が必要な場合があるかもしれません。たとえば、パフォーマンス上の理由からコードの一部が入り組んでいて追跡が困難な場合や、複雑な数学演算のシーケンスで予想外の方法で型変換が行われる場合があります。このような場合、またそれ以外にも多くの場合、将来のメンテナがミスをしないように、また読者がリバースエンジニアリングをしなくてもコードを理解できるように、付随するコメントや ドキュメントでこれらの側面を説明することが重要です。

また、分かりやすくするために余計なコメントをつけると、かえってコードが散らかったり、すでに書いてあることを繰り返し書いたり、コードと矛盾したり、コメントを最新に保つためにメンテナンスの負担が増えたりして、コードの目的が分からなくなることがあるので注意が必要です。冗長なコメントを追加するのではなく、コードが自ら語るようにします（たとえば、シンボル名自体を自己記述型にする）。コメントは、コードが何をしているかではなく、なぜそれが行われるのかを説明する方がよい場合が多いです。

Googleのコードベースは、ほぼ均一で一貫しています。見慣れないパターンを使っているなど、目立つコードにはそれなりの理由があることがよくあります。この性質を維持することは、新しいコードを読むときにどこに注目すべきかを読者に明らかにするために重要です。

標準ライブラリには、この原則を実践している例がたくさんあります。そのうちのひとつが以下です。

- [sortパッケージ](https://cs.opensource.google/go/go/+/refs/tags/go1.19.2:src/sort/sort.go)におけるメンテナコメント
- [同じパッケージの中にある実行可能な良いサンプル](https://cs.opensource.google/go/go/+/refs/tags/go1.19.2:src/sort/example_search_test.go)は、ユーザー（[godocに表示される](https://pkg.go.dev/sort#pkg-examples)）とメンテナ（[テストの一部として実行される](https://google.github.io/styleguide/go/decisions#examples)）の両方に利益をもたらします。
- [strings.Cut](https://pkg.go.dev/strings#Cut)はたった4行のコードですが、[呼び出しの明確さと正確さ](https://github.com/golang/go/issues/46336)を向上させるものです。
